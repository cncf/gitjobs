/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/@open-iframe-resizer/core@1.3.1/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const p=()=>typeof window<"u",R=()=>window.self!==window.top,b=e=>e instanceof HTMLIFrameElement,M=e=>{"complete"===window.document.readyState?e():window.addEventListener("load",e)},T=(e,t)=>{t(),e.addEventListener("load",t)},C=(e,t)=>{var n,i;const r="complete"===(null==(n=e.contentWindow)?void 0:n.document.readyState);return"about:blank"!==e.src&&"about:blank"!==(null==(i=e.contentWindow)?void 0:i.location.href)&&r?t():e.addEventListener("load",t)},k=()=>({offsetSize:0,checkOrigin:!0,enableLegacyLibSupport:!1}),B=e=>{try{return new URL(e.src).origin===window.location.origin}catch{return!1}},D=e=>{try{const t=new URL(e.src).origin;if("about:blank"!==t)return t}catch{}return null},A=e=>(Object.keys(e).forEach((t=>void 0===e[t]&&delete e[t])),e),L=e=>{const{height:t,width:n}=e.getBoundingClientRect();return{height:Math.ceil(t),width:Math.ceil(n)}},f=(e,t)=>e?t?e.querySelector(t):e.documentElement:null,I=(e,t)=>{e&&(t.bodyPadding&&(e.body.style.padding=t.bodyPadding),t.bodyMargin&&(e.body.style.margin=t.bodyMargin))},m=e=>e<=100?100:e<=120?1e3:1e4,H=()=>"[iFrameSizer]ID:0:false:false:32:true:true::auto:::0:false:child:auto:true:::true:::false";function P(e){if("string"==typeof e.data&&e.data.startsWith("[iFrameSizer]")){const[t,n]=e.data.split(":"),i=+n;return i>0?i:null}return null}const v=q();let l=[];const K=(e,t)=>{if(!p())return[];const n={...k(),...A(e??{})},i=W(t),r=x(n,i);return i.map((e=>{const t={iframe:e,settings:n,interactionState:{isHovered:!1},initContext:{isInitialized:!1,retryAttempts:0}},i=F(t,r);return l.push(t),{unsubscribe:()=>{i(),l=l.filter((t=>t.iframe!==e))}}}))};function W(e){return"string"==typeof e?Array.from(document.querySelectorAll(e)).filter(b):e?b(e)?[e]:[]:Array.from(document.getElementsByTagName("iframe"))}function x(e,t){if(Array.isArray(e.checkOrigin))return e.checkOrigin;if(!e.checkOrigin)return[];const n=[];for(const e of t){const t=D(e);t&&n.push(t)}return n}function F(e,t){const n=B(e.iframe)?U(e):N(e,t),i=$(e);return()=>{n(),i()}}function N(e,t){const{iframe:n,initContext:i,settings:{checkOrigin:r,enableLegacyLibSupport:o,targetElementSelector:a,bodyPadding:s,bodyMargin:c}}=e,d=i=>{var a;const s=!r||t.includes(i.origin);if(n.contentWindow===i.source&&s){if("iframe-resized"===(null==(a=i.data)?void 0:a.type)){const{height:t}=i.data;return void(t&&g({newHeight:t,registeredElement:e}))}if(o){const t=P(i);return void(null!==t&&g({newHeight:t,registeredElement:e}))}}};window.addEventListener("message",d);const u=o?H():{type:"iframe-child-init",targetElementSelector:a,bodyPadding:s,bodyMargin:c},l=()=>{T(n,(()=>{var e;return null==(e=n.contentWindow)?void 0:e.postMessage(u,"*")})),i.retryAttempts++,i.retryTimeoutId=window.setTimeout(l,m(i.retryAttempts))};return l(),()=>window.removeEventListener("message",d)}function U(e){const{iframe:t,settings:n}=e,{targetElementSelector:i}=n;let r=0;const o=()=>{const e=f(t.contentDocument,i);if(!t.contentDocument||!e)return r++,setTimeout(o,m(r));I(t.contentDocument,n),v().observe(e)};return C(t,o),()=>{const e=f(t.contentDocument,i);e&&v().unobserve(e),t.removeEventListener("load",o)}}function $({iframe:e,interactionState:t}){const n=()=>{t.isHovered=!0},i=()=>{t.isHovered=!1};return e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",i),()=>{e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",i)}}function q(){let e=null;return()=>{if(!e){const t=({target:e})=>{const t=l.find((({iframe:t})=>t.contentDocument===e.ownerDocument));if(!t)return;const{iframe:n,settings:i}=t,r=f(n.contentDocument,i.targetElementSelector);if(!r)return;const{height:o}=L(r);o&&g({newHeight:o,registeredElement:t})};e=new ResizeObserver((e=>e.forEach(t)))}return e}}function g({registeredElement:e,newHeight:t}){const{iframe:n,settings:i,interactionState:r,initContext:o}=e;o.isInitialized||(o.isInitialized=!0,clearTimeout(o.retryTimeoutId));const a=n.getBoundingClientRect(),s=t+i.offsetSize;if(n.style.height=`${s}px`,!i.onIframeResize)return;const c={iframe:n,settings:{...i},interactionState:{...r},previousRenderState:{rect:a},nextRenderState:{rect:n.getBoundingClientRect()}};i.onIframeResize(c)}const V=G();let z=!1;function _(){!p()||!R()||window.addEventListener("message",(e=>{var t;"iframe-child-init"===(null==(t=e.data)?void 0:t.type)&&M((()=>O(e)))}))}function O(e,t=0){const{targetElementSelector:n,bodyPadding:i,bodyMargin:r}=e.data,o=f(document,n);if(z||window.parent!==e.source)return;if(!o)return setTimeout((()=>O(e,t+1)),m(t));I(document,{bodyMargin:r,bodyPadding:i});const a=V();a.disconnect(),a.observe(o),z=!0}function G(){let e=null;return()=>(e||(e=new ResizeObserver((e=>{if(!e[0].target)return;const{height:t,width:n}=L(e[0].target),i={type:"iframe-resized",width:n,height:t};window.parent.postMessage(i,"*")}))),e)}_();const Q=({previousRenderState:e,nextRenderState:t,iframe:n})=>{document.activeElement===n&&window.scrollBy(0,t.rect.bottom-e.rect.bottom)};export{K as initialize,_ as initializeChildListener,Q as updateParentScrollOnResize};
