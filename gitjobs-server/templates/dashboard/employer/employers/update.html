{% import "macros.html" as macros %}

<div class="space-y-12">
  <div>
    {% call macros::form_title(title = "Employer profile", description = "This information will be displayed in your jobs postings. You can update it at anytime.") %}
  </div>

  <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 max-w-4xl">
    {# Form image #}
    <div class="col-span-full">
      {% call macros::images_form(label = "Company logo", name = "logo_id", value = employer.logo_id|display_some) %}
    </div>
    {# End form image #}
  </div>

  {# Employer form #}
  <form id="employer-form"
        hx-put="/dashboard/employer/employers/update"
        hx-ext="no-empty-vals"
        hx-include="[name=logo_id]"
        hx-trigger="submit"
        hx-indicator="#form-spinner">
    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 max-w-4xl">
      {# Company name #}
      <div class="col-span-3">
        <label for="company" class="form-label">
          Company name <span class="asterisk">*</span>
        </label>
        <div class="mt-2">
          <input type="text"
                 name="company"
                 id="company"
                 value="{{ employer.company }}"
                 class="input-primary"
                 autocomplete="off"
                 autocorrect="off"
                 autocapitalize="off"
                 spellcheck="false"
                 required>
        </div>
        <p class="form-legend">Your company's trade name.</p>
      </div>
      {# End Company name #}

      <div class="col-span-3"></div>

      {# Member #}
      <div class="col-span-full">
        <label for="member" class="form-label">CNCF member</label>
        {% call macros::search_member(member_id = employer.member_id|display_some, member_name = employer.member_name|display_some, member_level = employer.member_level|display_some, member_logo_url = employer.member_logo_url|display_some) %}
        <p class="form-legend">
          If your company is a member of the CNCF please select the corresponding member entry. Jobs posted by members will be featured across the site. False membership claims may lead to the suspension of the employer and associated user accounts.
        </p>
        <div id="selected-member" class="flex space-x-5">
          {% if let Some(member_id) = employer.member_id %}
            <div class="relative border rounded-lg p-4 pe-10 bg-white mt-4 min-w-64">
              <button id="remove-{{ member_id }}"
                      data-id="{{ member_id }}"
                      type="button"
                      class="rounded-full bg-gray-100 hover:bg-gray-200 absolute top-1 end-1">
                <div class="svg-icon size-5 bg-gray-400 hover:bg-gray-700 icon-close"></div>
              </button>
              {% let level = employer.member_level|display_some %}
              {% let label = &format!("CNCF {} member", level) %}
              {% call macros::dropdown_card(name = employer.member_name|display_some, label = label, logo_url = employer.member_logo_url|display_some) %}
            </div>
            <script type="module">
              import {
                removeSelectedMember
              } from '/static/js/common/members.js';

              const removeBtn = document.getElementById('remove-{{ member_id }}');
              if (removeBtn) {
                removeBtn.addEventListener('click', () => {
                  removeSelectedMember('{{ member_id }}');
                });
              }
            </script>
          {% endif %}
        </div>
      </div>
      {# End member #}

      {# Location #}
      <div class="col-span-full lg:col-span-3">
        <label for="ts_query" class="form-label">Location</label>
        {% call macros::location(location_id = employer.location_id|display_some, city = employer.city|display_some, state = employer.state|display_some, country = employer.country|display_some) %}
        <p class="form-legend">Location of the headquarters of your company.</p>
      </div>
      {# End location #}

      {# Website url #}
      <div class="sm:col-span-3">
        <label for="website_url" class="form-label">Website url</label>
        <div class="mt-2">
          <input id="website_url"
                 name="website_url"
                 type="url"
                 value="{%- if let Some(website_url) = employer.website_url -%} {{ website_url }} {%- endif -%}"
                 class="input-primary">
        </div>
        <p class="form-legend">URL of your company's website.</p>
      </div>
      {# End Website url #}

      {# Description #}
      <div class="col-span-full">
        <label for="description" class="form-label">
          Description <span class="asterisk">*</span>
        </label>
        <div class="mt-2">
          <markdown-editor id="description" content="{{ employer.description }}" required></markdown-editor>
        </div>
        <p class="form-legend">A short introduction of your company. You can use markdown to format the text.</p>
      </div>
      {# End Description #}

      {# Public #}
      <div class="col-span-full">
        <div class="form-label">Public</div>
        <label class="mt-2 inline-flex items-center cursor-pointer">
          {% call macros::toggle_checkbox(id = "public", checked = employer.public) %}
          <span class="ms-3 text-sm font-medium text-gray-900">Display in employers listing</span>
        </label>
        <p class="form-legend">
          Your company will be listed in the employers section of the site. This may help attracting more applicants to your jobs.
        </p>
      </div>
      {# End Public #}
    </div>

    <div class="mt-12 flex items-center justify-end gap-x-6 border-t border-gray-900/10 pt-6">
      {# Cancel button #}
      <a hx-boost="true"
         href="/dashboard/employer?tab=profile"
         class="btn-primary-outline">Cancel</a>
      {# End cancel button #}

      <div class="relative">
        <div id="form-spinner"></div>
        {# Submit employer form button #}
        <button type="submit" class="btn-primary">Save</button>
        {# End submit employer form button #}
      </div>
    </div>
  </form>
  {# End employer form #}
</div>
