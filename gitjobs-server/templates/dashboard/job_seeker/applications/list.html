{% import "macros/ui.html" as ui -%}
{% import "macros/preview_modal.html" as preview_modal -%}
{% import "macros/job_seeker.html" as job_seeker -%}

{{ ui::form_title(title = "My applications") -}}

{# Applicants Table -#}
<div class="relative overflow-visible mt-10">
  <table class="table-fixed w-full text-xs lg:text-sm text-left rtl:text-right text-stone-500">
    <thead class="text-xs text-stone-700 uppercase bg-stone-100 border-b border-stone-200">
      <tr>
        <th scope="col" class="px-3 xl:px-5 py-3">Position</th>
        <th scope="col" class="px-3 xl:px-5 py-3 w-32">Applied</th>
        <th scope="col" class="p-4 w-12"></th>
      </tr>
    </thead>
    <tbody id="applications-list">
      {% if applications.is_empty() -%}
        <tr class="bg-white border-b border-stone-200">
          {# No applications -#}
          <td class="px-8 py-20 text-center" colspan="3">
            <div class="text-xl lg:text-2xl mb-10">
              <div>You have not applied yet to any jobs within GitJobs.</div>
            </div>
            <p class="text-stone-700 mb-10">
              Please note that jobs that use an external apply url won't be displayed here.
            </p>
          </td>
        </tr>
      {% else -%}
        {% for application in applications -%}
          <tr class="odd:bg-white even:bg-stone-50/50 border-b border-stone-200">
            {# Position -#}
            <td class="px-3 xl:px-5 py-4 font-medium text-stone-900">
              {% if application.job_status == JobStatus::Published -%}
                <button hx-get="/section/jobs/{{ application.job_id }}"
                        hx-target="#preview-content"
                        hx-disabled-elt="this"
                        class="flex flex-col justify-between items-start cursor-pointer preview-button max-w-full min-w-0">
                  <div class="flex align-center gap-x-3 w-full">
                    <div class="max-w-full text-black truncate">{{ application.job_title }}</div>
                  </div>
                  {# Location -#}
                  {{ job_seeker::location(workplace = application.job_workplace, job_location = application.job_location) }}
                  {# End location -#}
                </button>
              {% else -%}
                <div class="flex flex-col justify-between items-start max-w-full min-w-0">
                  <div class="flex align-center gap-x-3 w-full">
                    <div class="max-w-full text-black truncate">{{ application.job_title }}</div>
                    <span class="bg-orange-100 text-orange-800 text-[0.65rem] text-nowrap h-[17px] px-2.5 pt-0.5 rounded-full">
                      {% if application.job_status == JobStatus::PendingApproval -%}
                        This job is awaiting moderators approval
                      {% else -%}
                        This job was {{ application.job_status.to_string() }}
                      {% endif -%}
                    </span>

                  </div>
                  {# Location -#}
                  {{ job_seeker::location(workplace = application.job_workplace, job_location = application.job_location) }}
                  {# End location -#}
                </div>
              {% endif -%}
            </td>
            {# End postion -#}

            {# Applied date -#}
            <td class="px-3 xl:px-5 py-4 whitespace-nowrap">{{ application.applied_at.format(DATE_FORMAT) }}</td>
            {# End applied date -#}

            {# Actions -#}
            <td>
              <div>
                <button id="cancel-application-{{ application.application_id }}"
                        data-cancel-application-button="true"
                        hx-put="/dashboard/job-seeker/applications/{{ application.application_id }}/cancel"
                        hx-disabled-elt="this"
                        hx-trigger="confirmed"
                        class="btn-tertiary p-2">
                  <div class="svg-icon size-4 icon-trash"></div>
                </button>
              </div>
            </td>
            {# End actions -#}
          </tr>
        {% endfor -%}
      {% endif -%}
    </tbody>
  </table>
</div>
{# End applicants Table -#}

{# Preview modal -#}
{{ preview_modal::modal() -}}
{# End preview modal -#}

<script type="module">
  import {
    initializeJobSeekerApplicationsList
  } from '/static/js/dashboard/jobseeker/applications.js';

  initializeJobSeekerApplicationsList();
</script>
