{% import "jobboard/jobs/jobs_macros.html" as jobs_macros %}

{# Mobile filters -#}
<div id="drawer-filters"
     class="fixed top-0 left-0 z-[1100] h-screen overflow-y-auto -translate-x-full bg-white w-80 border border-r shadow-lg"
     role="dialog"
     data-open="false"
     tabindex="-1"
     aria-labelledby="drawer-label">
  {# Close button -#}
  <button id="close-filters"
          type="button"
          class="group bg-transparent hover:bg-gray-200 rounded-full text-sm w-8 h-8 absolute top-4 end-2.5 flex items-center justify-center">
    <div class="svg-icon h-4 w-4 bg-gray-400 group-hover:bg-gray-900 icon-close"></div>
    <span class="sr-only">Close menu</span>
  </button>
  {# End close button -#}

  {# Filters content -#}
  {# Header Filters -#}
  <div class="flex justify-between items-center border-solid border-0 border-b border-gray-100 p-5">
    <div class="font-semibold text-sm text-black">Filters</div>
  </div>
  {# End header filters -#}

  <form id="mobile-jobs-form"
        hx-get='/jobs/section/results'
        hx-trigger="change"
        hx-target="#items-list"
        hx-include="[name='ts_query']"
        hx-ext="no-empty-vals"
        hx-boost="true">
    {% call jobs_macros::filters(device = "mobile") %}
  </form>
  {# End filters content -#}

  <div class="text-end p-5">
    <button id="reset-mobile-jobs-form"
            class="btn-primary-outline btn-mini group">
      <div class="flex items-center space-x-1">
        <div class="svg-icon size-3 icon-close group-hover:bg-white"></div>
        <div>Reset</div>
      </div>
    </button>
  </div>
</div>
{# Overlay -#}
<div id="drawer-backdrop"
     class="hidden bg-gray-900/50 fixed inset-0 z-[1050]"></div>
{# End overlay -#}
{# End mobile filters -#}

<div class="relative container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 flex flex-grow h-full">
  <div class="flex items-start w-full h-full">

    {# Filters #}
    <div class="relative hidden w-[28%] max-w-[28%] xl:w-1/4 xl:max-w-1/4 lg:block bg-white border rounded-3xl">

      {# Header #}
      <div class="flex justify-between items-center border-solid border-0 border-b border-gray-100 p-5">
        <div class="font-semibold text-sm text-black">Filters</div>

        <div>
          <button id="reset-desktop-jobs-form" class="btn-primary-outline btn-mini">Reset</button>
        </div>
      </div>
      {# End header #}

      <form id="desktop-jobs-form"
            hx-get='/jobs/section/results'
            hx-trigger="change"
            hx-target="#items-list"
            hx-include="[name='ts_query']"
            hx-ext="no-empty-vals"
            hx-boost="true">
        {% call jobs_macros::filters() %}
      </form>
    </div>
    {# End filters #}

    {# Content #}
    <div class="relative w-full h-full lg:w-[72%] xl:w-3/4 lg:pl-6 xl:pl-10 self-stretch">
      <div class="relative flex flex-col bg-white border rounded-3xl pt-5 md:pt-7 h-full w-full">
        <div class="flex lg:items-center mb-6 md:mb-10 px-5 md:px-7">
          <div class="flex align-items w-full">
            {# Mobile filters button -#}
            <div class="flex shrink-0 me-6 lg:hidden">
              <button id="open-filters"
                      class="btn-primary-outline group size-[40px] items-center flex justify-center">
                <div class="svg-icon size-4 icon-filter group-hover:bg-white shrink-0"></div>
              </button>
            </div>
            {# End mobile filters button -#}

            {# Searchbar #}
            <div class="flex items-center justify-center w-full">
              <div class="relative w-full md:w-3/4 md:-ml-[0.75rem]">
                <input id="ts_query"
                       name="ts_query"
                       type="text"
                       value='{{ filters.ts_query|display_some_or("") }}'
                       class="peer w-[100%] rounded-full border border-gray-300 text-gray-900 placeholder-gray-400 focus:ring-transparent focus:border-primary-500 focus:ring block flex-1 min-w-0 w-60 text-md p-2.5 ps-4 pe-14"
                       placeholder="Search jobs"
                       autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       spellcheck="false">
                <div class="absolute right-[40px] top-[10px] block peer-placeholder-shown:hidden">
                  {# Clean searchbar #}
                  <button id="clean-search-jobs"
                          class="mr-2 mt-[2px] block peer-placeholder-shown:hidden">
                    <div class="svg-icon h-5 w-5 bg-gray-400 hover:bg-gray-700 icon-close"></div>
                  </button>
                  {# End clean searchbar #}
                </div>
                <div class="absolute right-[6px] top-[6px]">
                  {# Search button #}
                  <button id="search-jobs-btn" class="btn-primary-outline group p-2">
                    <div class="svg-icon size-4 mx-auto bg-primary-500 group-hover:bg-white icon-search"></div>
                  </button>
                  {# End search button #}
                </div>
              </div>
            </div>
            {# End searchbar #}
          </div>
        </div>

        {# Results #}
        <div id="results"
             class="flex flex-row items-center justify-between px-5 md:px-7">
          {% if results_section.jobs.len() > 0 %}
            {% call jobs_macros::current_page(total = results_section.total, items_number = results_section.jobs.len(), offset_value = results_section.offset) %}
          {% endif %}
        </div>
        {# End results #}

        <div id="items-list" class="flex flex-col justify-between h-full">
          {# Results #}
          {{ results_section|safe }}
          {# End results #}
        </div>
      </div>
      {# End content #}
    </div>
  </div>
</div>
<script type="module">
  import {
    open,
    close,
    searchOnEnter,
    cleanInputField,
    triggerChangeOnForm,
    resetForm
  } from '/static/js/jobboard/filters.js';

  const openFiltersBtn = document.getElementById('open-filters');
  openFiltersBtn.addEventListener('click', open);

  const closeFiltersBtn = document.getElementById('close-filters');
  closeFiltersBtn.addEventListener('click', close);

  const backdropFilters = document.getElementById('drawer-backdrop');
  backdropFilters.addEventListener('click', close);

  const searchInput = document.getElementById('ts_query');
  searchInput.addEventListener('keydown', () => searchOnEnter(event, 'desktop-jobs-form'));

  const cleanSearch = document.getElementById('clean-search-jobs');
  cleanSearch.addEventListener('click', () => cleanInputField('ts_query', 'desktop-jobs-form'));

  const searchJobsBtn = document.getElementById('search-jobs-btn');
  searchJobsBtn.addEventListener('click', () => triggerChangeOnForm('desktop-jobs-form', true));

  const resetDesktopJobsForm = document.getElementById('reset-desktop-jobs-form');
  resetDesktopJobsForm.addEventListener('click', () => resetForm('desktop-jobs-form'));

  const resetMobileJobsForm = document.getElementById('reset-mobile-jobs-form');
  resetMobileJobsForm.addEventListener('click', () => resetForm('mobile-jobs-form'));
</script>
