{% import "macros.html" as macros %}

{# Filters #}
{% macro filters(device = "desktop") %}
  {# Job type #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Kind") %}
    <ul class="flex w-full gap-2 mt-3 flex-col">
      {# Full time #}
      {% call checkbox(name = "kind[]", value = JobKind::FullTime, label = "Full Time", icon = "signature", active_filters = filters.kind, required = false, device = device) %}
      {# End Full time #}

      {# Part time #}
      {% call checkbox(name = "kind[]", value = JobKind::PartTime, label = "Part Time", icon = "hour_glass", active_filters = filters.kind, required = false, device = device) %}
      {# End Part time #}

      {# Contractor #}
      {% call checkbox(name = "kind[]", value = JobKind::Contractor, label = "Contractor", icon = "clipboard", active_filters = filters.kind, required = false, device = device) %}
      {# End Contractor #}

      {# Internship #}
      {% call checkbox(name = "kind[]", value = JobKind::Internship, label = "Internship", icon = "graduation_cap", active_filters = filters.kind, required = false, device = device) %}
      {# End Internship #}
    </ul>
  </div>
  {# End job type #}

  {# Workplace #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Workplace") %}
    <ul class="flex w-full gap-2 mt-3 flex-col">
      {# On site #}
      {% call checkbox(name = "workplace[]", value = Workplace::OnSite, label = "On Site", icon = "office_chair", active_filters = filters.workplace, required = false, device = device) %}
      {# End On site #}

      {# Remote #}
      {% call checkbox(name = "workplace[]", value = Workplace::Remote, label = "Remote", icon = "remote", active_filters = filters.workplace, required = false, device = device) %}
      {# End Remote #}

      {# Hybrid #}
      {% call checkbox(name = "workplace[]", value = Workplace::Hybrid, label = "Hybrid", icon = "buildings", active_filters = filters.workplace, required = false, device = device) %}
      {# End Hybrid #}
    </ul>
  </div>
  {# End workplace #}

  {# Skills #}
  <div>
    <collapsible-filter title="Skills" name="skills" options="{{ filters_options.skills|json }}" form="{{ device }}-jobs-form" {%- if let Some(filters_skills) = filters.skills %}selected="{{ filters_skills|json }}"{%- endif -%}></collapsible-filter>
  </div>
  {# End skills #}

  {# Benefits #}
  <div>
    <collapsible-filter title="Benefits" name="benefits" options="{{ filters_options.benefits|json }}" form="{{ device }}-jobs-form" {%- if let Some(filters_benefits) = filters.benefits %}selected="{{ filters_benefits|json }}"{%- endif -%}></collapsible-filter>
  </div>
  {# End benefits #}

  {# Projects #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Projects") %}
    {% let projects_id = "{}-projects"|format(device) %}
    <div class="relative">{% call macros::search_project(id = projects_id, mini = true) %}</div>
    <div id="selected-{{ projects_id }}"
         projects="{{ filters.projects|json }}"
         class="flex flex-col space-y-2 mt-2"></div>
    <script type="module">
      import {
        addProjectCard
      } from '/static/js/misc/projects.js';

      const selectedProjects = document.getElementById('selected-{{ projects_id }}');
      if (selectedProjects) {
        const projects = selectedProjects.dataset.projects;
        if (projects) {
          const parsedProjects = JSON.parse(projects);
          parsedProjects.forEach((project) => {
            addProjectCard(project.project_id, project.name, project.maturity, project.logo_url, 'selected-{{ projects_id }}', true);
          });
        }
      }
    </script>
  </div>
  {# End projects #}

  {# Open source #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Open source") %}
    <div class="mt-3">
      {% call macros::input_range(id = "{}_open_source"|format(device), name = "open_source", value = filters.open_source|display_some_or(0)) %}
    </div>
  </div>
  {# End open source #}

  {# Upstream commitment #}
  <div class="px-6 py-7 pt-5">
    {% call filters_title(text = "Upstream commitment") %}
    <div class="mt-3">
      {% call macros::input_range(id = "{}_upstream_commitment"|format(device), name = "upstream_commitment", value = filters.upstream_commitment|display_some_or(0)) %}
    </div>
  </div>
  {# End upstream commitment #}
{% endmacro filters %}
{# End filters #}

{# Filters title #}
{% macro filters_title(text) %}
  <div class="font-semibold text-black text-[0.8rem]/6">{{ text }}</div>
{% endmacro filters_title %}
{# End filters title #}

{# Current page #}
{% macro current_page(total, items_number, offset_value) -%}
  {%- if let Some(offset) = offset_value -%}
    {{ offset + 1 }} - {{ items_number + offset }}
  {%- else -%}
    1 - {{ items_number }}
  {%- endif -%}
  {{ "" }} of {{ total }} results
{%- endmacro current_page %}
{# End current page #}

{# Checkbox #}
{% macro checkbox(name, value, label, icon, active_filters, required = false, device = "") %}
  <li class="group">
    <input id="{%- if !device.is_empty() -%}{{ device }}-{%- endif -%}{{ name }}-{{ value }}"
           type="checkbox"
           name="{{ name }}"
           value="{{ value }}"
           class="hidden peer"
           {%- if let Some(active_filters) = active_filters -%} {%- if active_filters.contains(value) -%}checked{%- endif -%} {%- endif %}
           {% if required %}required{% endif %}>
    <label for="{%- if !device.is_empty() -%}{{ device }}-{%- endif -%}{{ name }}-{{ value }}"
           class="inline-flex items-center w-full px-2 py-1 text-gray-500 space-x-3 bg-white border rounded-lg cursor-pointer select-none peer-checked:border-primary-500 hover:text-gray-600 peer-checked:text-primary-500 hover:bg-gray-50">
      <div class="svg-icon size-3 icon-{{ icon }} bg-gray-500 cursor-pointer group-has-[input:checked]:bg-primary-500">
      </div>
      <div class="text-[0.8rem] text-center text-nowrap">{{ label }}</div>
    </label>
  </li>
{% endmacro checkbox %}
{# End checkbox #}
