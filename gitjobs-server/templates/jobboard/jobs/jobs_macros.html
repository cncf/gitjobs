{% import "macros.html" as macros %}

{# Filters #}
{% macro filters(device = "desktop") %}
  {# Job type #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Kind") %}
    <div class="mt-3 flex flex-col space-y-3">
      {# Full time #}
      {% call macros::checkbox_box(name = "kind[]", value = JobKind::FullTime, label = "Full Time", icon = "signature", active_filters = filters.kind, required = false, device = device) %}
      {# End Full time #}

      {# Part time #}
      {% call macros::checkbox_box(name = "kind[]", value = JobKind::PartTime, label = "Part Time", icon = "hour_glass", active_filters = filters.kind, required = false, device = device) %}
      {# End Part time #}

      {# Contractor #}
      {% call macros::checkbox_box(name = "kind[]", value = JobKind::Contractor, label = "Contractor", icon = "clipboard", active_filters = filters.kind, required = false, device = device) %}
      {# End Contractor #}

      {# Internship #}
      {% call macros::checkbox_box(name = "kind[]", value = JobKind::Internship, label = "Internship", icon = "graduation_cap", active_filters = filters.kind, required = false, device = device) %}
      {# End Internship #}
    </div>
  </div>
  {# End job type #}

  {# Workplace #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Workplace") %}
    <div class="mt-3 flex flex-col space-y-3">
      {# On site #}
      {% call macros::checkbox_box(name = "workplace[]", value = Workplace::OnSite, label = "On Site", icon = "office_chair", active_filters = filters.workplace, required = false, device = device) %}
      {# End On site #}

      {# Remote #}
      {% call macros::checkbox_box(name = "workplace[]", value = Workplace::Remote, label = "Remote", icon = "remote", active_filters = filters.workplace, required = false, device = device) %}
      {# End Remote #}

      {# Hybrid #}
      {% call macros::checkbox_box(name = "workplace[]", value = Workplace::Hybrid, label = "Hybrid", icon = "buildings", active_filters = filters.workplace, required = false, device = device) %}
      {# End Hybrid #}
    </div>
  </div>
  {# End workplace #}

  {# Skills #}
  <div>
    <collapsible-filter title="Skills" name="skills" options="{{ filters_options.skills|json }}" form="{{ device }}-jobs-form" {%- if let Some(filters_skills) = filters.skills %}selected="{{ filters_skills|json }}"{%- endif -%}></collapsible-filter>
  </div>
  {# End skills #}

  {# Benefits #}
  <div>
    <collapsible-filter title="Benefits" name="benefits" options="{{ filters_options.benefits|json }}" form="{{ device }}-jobs-form" {%- if let Some(filters_benefits) = filters.benefits %}selected="{{ filters_benefits|json }}"{%- endif -%}></collapsible-filter>
  </div>
  {# End benefits #}

  {# Projects #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Projects") %}
    {% let projects_id = "{}-projects"|format(device) %}
    <div class="relative">{% call macros::search_project(id = projects_id, mini = true) %}</div>
    <div id="selected-{{ projects_id }}" class="flex flex-col space-y-2"></div>
    <script type="module">
      import {
        addProjectCard
      } from '/static/js/common/projects.js';

      const selectedProjects = document.getElementById('selected-{{ projects_id }}');
      if (selectedProjects) {
        const projects = selectedProjects.dataset.projects;
        if (projects) {
          const parsedProjects = JSON.parse(projects);
          parsedProjects.forEach((project) => {
            addProjectCard(project.project_id, project.name, project.maturity, project.logo_url, 'selected-{{ projects_id }}', true);
          });
        }
      }
    </script>
  </div>
  {# End projects #}

  {# Open source #}
  <div class="px-6 py-7 pt-5 border-b border-gray-100">
    {% call filters_title(text = "Open source") %}
    <div class="mt-3">
      {% call macros::input_range(id = "{}_open_source"|format(device), name = "open_source", value = filters.open_source|display_some_or(0)) %}
    </div>
  </div>
  {# End open source #}

  {# Upstream commitment #}
  <div class="px-6 py-7 pt-5">
    {% call filters_title(text = "Upstream commitment") %}
    <div class="mt-3">
      {% call macros::input_range(id = "{}_upstream_commitment"|format(device), name = "upstream_commitment", value = filters.upstream_commitment|display_some_or(0)) %}
    </div>
  </div>
  {# End upstream commitment #}
{% endmacro filters %}
{# End filters #}

{# Filters title #}
{% macro filters_title(text) %}
  <div class="font-semibold text-black text-sm/6">{{ text }}</div>
{% endmacro filters_title %}
{# End filters title #}

{# Current page #}
{% macro current_page(total, items_number, offset_value) -%}
  {%- if let Some(offset) = offset_value -%}
    {{ offset + 1 }} - {{ items_number + offset }}
  {%- else -%}
    1 - {{ items_number }}
  {%- endif -%}
  {{ "" }} of {{ total }} results
{%- endmacro current_page %}
{# End current page #}
