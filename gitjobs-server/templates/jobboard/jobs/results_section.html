{% import "macros.html" as macros %}
{% import "jobboard/jobs/jobs_macros.html" as jobs_macros %}

<div class="flex flex-col divide-y divide-gray-100 border-b border-t border-gray-100 mt-5 md:mt-7">
  {% if jobs.len() == 0 %}
    {# Placeholder cards -#}
    <div class="p-10 md:p-14">
      <div class="border border-primary-300 p-10 text-sm text-gray-800 rounded-lg bg-primary-50 text-center"
           role="alert">
        <div class="text-md lg:text-lg">
          <p class="mb-10">We can't seem to find any jobs that match your search criteria.</p>
          <p>
            You can
            <button id="placeholder-reset-btn" class="p-0 underline">reset</button>
            your filters or try a different search.
          </p>
        </div>
      </div>
    </div>
    <script type="module">
      import {
        resetForm
      } from '/static/js/jobboard/filters.js';

      const resetBtn = document.getElementById('placeholder-reset-btn');
      resetBtn.addEventListener('click', () => resetForm('desktop-jobs-form'));
    </script>
    {# End placeholder cards -#}
  {% else %}
    {# Cards -#}
    {% for job in jobs %}
      <a hx-get="/jobs/{{ job.job_id }}"
         hx-target="body"
         hx-push-url="true"
         class="p-5 md:p-7 cursor-pointer hover:bg-gray-50">
        <div class="flex flex-1 flex-row items-center space-x-4 w-full">
          {# Company logo #}
          <div class="shrink-0">
            {% if let Some(logo_id) = job.employer.logo_id %}
              {% let logo = &self::build_jobboard_image_url(logo_id, "medium") %}
              {% let logo_small = &self::build_jobboard_image_url(logo_id, "small") %}
              <img class="size-14 flex rounded-lg"
                   height="56"
                   width="56"
                   srcset="{{ logo_small }}, {{ logo }} 2x"
                   src="{{ logo }}"
                   alt="{{ job.employer.company }} image">
            {% else %}
              <div class="rounded-full size-14 bg-gray-200 p-1 flex">
                <div class="svg-icon size-10 icon-company bg-gray-600 m-auto"></div>
              </div>
            {% endif %}
          </div>
          {# End company logo #}

          {# Info #}
          <div class="flex-grow min-w-0 content-center">
            <div class="flex justify-between items-center space-x-5">
              <div class="flex space-x-3 items-center">
                {# Company #}
                <div class="truncate leading-3 text-gray-400">
                  <span class="text-xs font-semibold tracking-wide uppercase">{{ job.employer.company }}</span>
                </div>
                {# End company #}
                {# Member #}
                {% if let Some(member) = job.employer.member %}
                  <div class="flex items-center space-x-2 text-[10px] border rounded-md uppercase px-2 ms-3 text-gray-500">
                    <div class="svg-icon size-2.5 icon-lfx bg-gray-500"></div>
                    <div>CNCF {{ member.level }} member</div>
                  </div>
                {% endif %}
                {# End member #}
              </div>

              {# Published date #}
              <div class="shrink-0 text-xs font-semibold text-gray-500">{{ job.published_at.format(DATE_FORMAT_3) }}</div>
              {# End published date #}
            </div>

            {# Title #}
            <div class="text-lg font-stretch-condensed font-medium text-gray-900 truncate mt-2">
              {{ job.title }}
              {% if let Some(location) = job.location %}
                <div class="inline-flex text-xs/6 text-gray-500 font-normal items-center">
                  <div>(</div>
                  <div class="svg-icon size-2.5 icon-location bg-gray-500 me-1"></div>
                  <div>{{ location.city }}, {{ location.country }}</div>
                  <div>)</div>
                </div>
              {% endif %}
            </div>
            {# End title #}
          </div>
          {# End info #}
        </div>

        <div class="my-5 flex items-center justify-center w-full bg-gray-50 border border-bg-gray-500 text-gray-500 text-xs font-medium uppercase px-10 py-1.5 rounded-full">
          {% let kind = job.kind.to_string() %}
          {% let workplace = job.workplace.to_string() %}
          <div class="basis-1/4">{{ kind|unnormalize }}</div>
          <div class="basis-1/4">{{ workplace|unnormalize }}</div>
          <div class="basis-1/4">Junior</div>
          <div class="basis-1/4 flex space-x-3 items-center">
            {% if let Some(open_source) = job.open_source %}
              {% if open_source + 0 > 0 %}
                <div class="svg-icon size-2.5 icon-check bg-green-500"></div>
              {% else %}
                <div class="svg-icon size-3 icon-close bg-red-500"></div>
              {% endif %}
            {% else %}
              <div class="svg-icon size-3 icon-close bg-red-500"></div>
            {% endif %}
            <div>Open source</div>
          </div>
        </div>

      </a>
    {% endfor %}
    {# End cards -#}
  {% endif %}
</div>

{# Pagination -#}
{# {% if jobs.len() > 0 %}{{ navigation_links|safe }}{% endif %} #}
{# End pagination -#}

{# djlint:off #}
{# <script type="module">
  import {
    updateResults
  } from '/static/js/jobboard/filters.js';

  {% if jobs.len() > 0 %}
    updateResults('{% call jobs_macros::current_page(total, jobs.len(), offset) %}');
  {% else %}
    updateResults('');
  {% endif %}
</script> #}
{# djlint:on #}
{# End list view -#}
